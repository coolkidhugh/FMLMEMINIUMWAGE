import streamlit as st
import datetime
import random

# ==============================================================================
# --- æ˜Ÿåº§åŒ¹é… & æ¸©æŸ”å¯„è¯­ç”Ÿæˆå™¨ ---
# ==============================================================================

# å˜»å˜»ï¼Œæ•¬çˆ±çš„æ€»ç»ç†æ˜¯è¿™ä¸ªæ˜Ÿåº§å“¦~
GM_SIGN = "å¤©èåº§"
GM_BIRTH_MONTH = 10 # å¤‡æ³¨ä¸€ä¸‹æœˆä»½~

# å¯çˆ±çš„æ˜Ÿåº§å®å®ä»¬çš„æ—¥æœŸèŒƒå›´~ (æœˆ, æ—¥)
ZODIAC_SIGNS = {
    "ç™½ç¾Šåº§": ((3, 21), (4, 19)), "é‡‘ç‰›åº§": ((4, 20), (5, 20)),
    "åŒå­åº§": ((5, 21), (6, 21)), "å·¨èŸ¹åº§": ((6, 22), (7, 22)),
    "ç‹®å­åº§": ((7, 23), (8, 22)), "å¤„å¥³åº§": ((8, 23), (9, 22)),
    "å¤©ç§¤åº§": ((9, 23), (10, 23)), "å¤©èåº§": ((10, 24), (11, 22)),
    "å°„æ‰‹åº§": ((11, 23), (12, 21)), "æ‘©ç¾¯åº§": ((12, 22), (1, 19)),
    "æ°´ç“¶åº§": ((1, 20), (2, 18)), "åŒé±¼åº§": ((2, 19), (3, 20))
}

# å“‡~ æ‚¨å’Œå¤©èåº§æ€»ç»ç†çš„ç¼˜åˆ†æŒ‡æ•°~ (ä»…ä¾›å‚è€ƒå“¦ï¼Œå¼€å¿ƒå°±å¥½~)
COMPATIBILITY_WITH_SCORPIO = {
    "å¤©èåº§": {"level": "çµé­‚çš„å¥‘åˆ~", "desc": "å“‡å“¦ï¼åŒä¸ºå¤©èåº§çš„ä½ ä»¬ï¼Œä»¿ä½›èƒ½è¯»æ‡‚å½¼æ­¤çš„å¿ƒå£°å‘¢ï¼ä¸€èµ·æºæ‰‹å¹¶è¿›ï¼Œä¸€å®šèƒ½åˆ›é€ æ— é™å¯èƒ½ï¼å’Œæ€»ç»ç†çœŸæ˜¯å¤©é€ åœ°è®¾çš„ä¼™ä¼´å‘€ï¼"},
    "åŒé±¼åº§": {"level": "æ¢¦å¹»èˆ¬çš„ç»„åˆ~", "desc": "åŒä¸ºæ°´è±¡æ˜Ÿåº§ï¼ŒçœŸæ˜¯å¿ƒæœ‰çµçŠ€ä¸€ç‚¹é€šï¼æ‚¨èƒ½ç†è§£æ€»ç»ç†æ·±é‚ƒçš„å†…å¿ƒï¼Œä»–ä¹Ÿèƒ½æ¬£èµæ‚¨çš„å–„è‰¯ä¸æ¸©æŸ”ã€‚å¥½å¥½åŠ æ²¹ï¼Œæœªæ¥å¯æœŸå“¦ï¼"},
    "å·¨èŸ¹åº§": {"level": "æ¸©æš–çš„ä¾é ~", "desc": "æ°´è±¡æ˜Ÿåº§çš„é»˜å¥‘çœŸæ˜¯å¤ªæ£’å•¦ï¼æ‚¨èƒ½ç»™äºˆæ€»ç»ç†è¸å®çš„æ¸©æš–ï¼Œä»–ä¹Ÿèƒ½æˆä¸ºæ‚¨åšå®çš„åç›¾ã€‚å…±åŒåŠªåŠ›ï¼Œä¸€å®šèƒ½æˆå°±ä¸€ç•ªäº‹ä¸šï¼"},
    "æ‘©ç¾¯åº§": {"level": "å¯é çš„ä¼™ä¼´~", "desc": "åœŸè±¡ä¸æ°´è±¡çš„ç»“åˆï¼Œç¨³ç¨³çš„å¹¸ç¦ï¼ä½ ä»¬éƒ½é‚£ä¹ˆåŠ¡å®ä¸”æœ‰è¿½æ±‚ï¼Œç›®æ ‡é«˜åº¦ä¸€è‡´ã€‚ç´§è·Ÿæ€»ç»ç†çš„æ­¥ä¼ï¼Œç¾å¥½çš„æœªæ¥åœ¨æ‹›æ‰‹å“¦ï¼"},
    "å¤„å¥³åº§": {"level": "ç»†è‡´çš„å’Œè°~", "desc": "åœŸä¸æ°´çš„äº¤èï¼Œè¿½æ±‚å®Œç¾çš„æ‚¨é‡ä¸Šå¯Œæœ‰æ´å¯ŸåŠ›çš„ä»–ï¼Œç®€ç›´å¤ªæ£’äº†ï¼æ‚¨å¯ä»¥å¸®åŠ©æ€»ç»ç†æŠŠå·¥ä½œåšå¾—å°½å–„å°½ç¾ã€‚ç”¨å¿ƒè¡¨ç°ï¼Œä»–ä¼šçœ‹åˆ°çš„ï¼"},
    "é‡‘ç‰›åº§": {"level": "éœ€è¦ç£¨åˆçš„ç¼˜åˆ†~", "desc": "ä¸¤ä½éƒ½æ˜¯å¾ˆæœ‰åŸåˆ™çš„å°å¯çˆ±å‘¢ã€‚éƒ½ç€çœ¼äºå®é™…ï¼Œä½†ä¹Ÿå¯èƒ½éœ€è¦æ›´å¤šæ²Ÿé€šæ¥é¿å…å°å°çš„å›ºæ‰§ã€‚å¤šå€¾å¬æ€»ç»ç†çš„æƒ³æ³•ï¼Œå…³ç³»ä¼šæ›´èæ´½å“’~"},
    "å¤©ç§¤åº§": {"level": "éœ€è¦ç£¨åˆçš„ç¼˜åˆ†~", "desc": "é£è±¡çš„çµåŠ¨é‡ä¸Šæ°´è±¡çš„æ·±æ²‰ï¼Œéœ€è¦ç”¨å¿ƒç»è¥å“¦ã€‚æ‚¨å‘å¾€å’Œè°ï¼Œæ€»ç»ç†åˆ™å¾ˆæœ‰ä¸»è§ã€‚å¤šä¸»åŠ¨æ²Ÿé€šï¼Œè¡¨è¾¾æ‚¨çš„çœŸè¯šï¼Œå…³ç³»ä¼šè¶Šæ¥è¶Šå¥½çš„ï¼"},
    "åŒå­åº§": {"level": "æœ‰è¶£çš„æŒ‘æˆ˜~", "desc": "æ·±æ²‰çš„ä»–é‡ä¸Šå¤šå˜çš„æ‚¨ï¼Œåƒæ˜¯æ¥è‡ªä¸åŒæ˜Ÿçƒçš„å°ç‹å­å‘¢ã€‚åœ¨æ€»ç»ç†é¢å‰ï¼Œå±•ç°æ‚¨æ²‰ç¨³å¯é çš„ä¸€é¢ï¼Œç”¨åŠªåŠ›è¯æ˜è‡ªå·±å§ï¼"},
    "å°„æ‰‹åº§": {"level": "æœ‰è¶£çš„æŒ‘æˆ˜~", "desc": "çƒ­æƒ…å¦‚ç«çš„æ‚¨é‡ä¸Šæ·±é‚ƒå¦‚æ°´çš„ä»–ï¼Œéœ€è¦æ‰¾åˆ°å¹³è¡¡ç‚¹å“¦ã€‚æ‚¨çƒ­çˆ±è‡ªç”±ï¼Œæ€»ç»ç†åˆ™æœ‰è§„åˆ’ã€‚åœ¨ä»–é¢å‰å¤šå±•ç°ç¨³é‡ï¼Œä¸€èµ·ä¸ºç›®æ ‡å¥‹æ–—å§ï¼"},
    "ç™½ç¾Šåº§": {"level": "æœ‰è¶£çš„æŒ‘æˆ˜~", "desc": "ç›´ç‡çš„æ‚¨é‡ä¸Šå¿ƒæ€æ·±é‚ƒçš„ä»–ï¼Œæˆ–è®¸ä¼šç¢°æ’å‡ºä¸ä¸€æ ·çš„ç«èŠ±ã€‚æ”¶æ•›ä¸€ç‚¹ç‚¹å†²åŠ¨ï¼Œå¤šå­¦ä¹ æ€»ç»ç†çš„æ™ºæ…§ï¼Œä¼šæ”¶è·å¾ˆå¤šå“¦ï¼"},
    "ç‹®å­åº§": {"level": "éœ€è¦äº’ç›¸æ¬£èµ~", "desc": "ä¸¤ä½éƒ½æ˜¯é—ªé—ªå‘å…‰çš„å­˜åœ¨å‘¢ï¼éƒ½å¾ˆæœ‰é¢†å¯¼åŠ›ã€‚åœ¨æ€»ç»ç†é¢å‰ï¼Œé€‚å½“å±•ç°æ‚¨çš„å°Šé‡ä¸é…åˆï¼Œå¼ºå¼ºè”åˆæ‰èƒ½æ›´å‰å®³å‘€ï¼"},
    "æ°´ç“¶åº§": {"level": "éœ€è¦äº’ç›¸æ¬£èµ~", "desc": "ç¥ç§˜çš„ä»–é‡ä¸Šç‹¬ç‰¹çš„æ‚¨ï¼Œæ€ç»´æ–¹å¼éƒ½å¾ˆç‰¹åˆ«å‘¢ï¼åœ¨æ€»ç»ç†é¢å‰å±•ç°æ‚¨åŠ¡å®åˆä½œçš„ä¸€é¢ï¼Œæ±‚åŒå­˜å¼‚ä¹Ÿå¾ˆæ£’å“¦ï¼"}
}

# æ¸©æŸ”çš„æ¯æ—¥å¯„è¯­~ åˆ†çº§åˆ«çš„å“¦ï¼Œè¿˜æœ‰é€šç”¨çš„ç¥ç¦~
FLATTERY_PHRASES = {
    "çµé­‚çš„å¥‘åˆ~": [
        "å¿ƒæœ‰çµçŠ€ä¸€ç‚¹é€šï¼å’Œæ€»ç»ç†å¦‚æ­¤é»˜å¥‘ï¼Œä»Šå¤©({date})çš„åˆä½œä¸€å®šä¼šè¶…çº§é¡ºåˆ©ï¼Œæˆæœæ»¡æ»¡ï¼",
        "çœŸæ˜¯æœ€ä½³æ‹æ¡£ï¼æ€»ç»ç†çš„è¿œè§å“è¯†åŠ ä¸Šæ‚¨çš„èªæ…§ï¼Œä»Šå¤©({date})å®šèƒ½ä¹˜é£ç ´æµªï¼",
        "ä¸€ä¸ªçœ¼ç¥å°±èƒ½æ˜ç™½å½¼æ­¤ï¼å’Œæ€»ç»ç†è¿™ä»½éš¾å¾—çš„é»˜å¥‘ï¼Œè®©ä»Šå¤©({date})çš„ä»»ä½•æŒ‘æˆ˜éƒ½å˜å¾—è½»æ¾èµ·æ¥ï¼"
    ],
    "æ¢¦å¹»èˆ¬çš„ç»„åˆ~": [
        "ç®€ç›´æ˜¯å®Œç¾çš„ç»„åˆï¼å’Œæ€»ç»ç†è¿™ä¹ˆåˆæ‹ï¼Œä»Šå¤©({date})ä¸€å®šä¼šå……æ»¡å¹¸è¿å’Œå–œæ‚¦ï¼Œäº‹åŠåŠŸå€ï¼",
        "æ„Ÿè§‰å¤ªæ£’å•¦ï¼å’Œæ€»ç»ç†çš„æ°”åœºå¦‚æ­¤å’Œè°ï¼Œä»Šå¤©({date})ä¸€å®šèƒ½å¿ƒæƒ³äº‹æˆï¼Œä¸‡äº‹å¦‚æ„ï¼",
        "èƒ½å¾—åˆ°æ€»ç»ç†({gm_sign})è¿™æ ·ä¼˜ç§€é¢†å¯¼çš„é’çï¼ŒçœŸæ˜¯å¤ªè£å¹¸äº†ï¼ä»Šå¤©({date})ä¹Ÿè¦å…ƒæ°”æ»¡æ»¡ï¼Œä¸è´Ÿè¿™ä»½é»˜å¥‘ï¼"
    ],
     "æ¸©æš–çš„ä¾é ~": [
        "æ¸©æš–åˆå¯é çš„ç»„åˆï¼å’Œæ€»ç»ç†ä¸€èµ·åŠªåŠ›ï¼Œä»Šå¤©({date})ä¸€å®šèƒ½äº’ç›¸æ”¯æŒï¼Œå…±åŒè¿›æ­¥ï¼",
        "é»˜å¥‘åè¶³ï¼Œåˆä½œæ— é—´ï¼ä»Šå¤©({date})ä¹Ÿè¦å’Œæ€»ç»ç†ä¸€èµ·ï¼Œä¸ºäº†å…±åŒçš„ç›®æ ‡åŠ æ²¹ï¼",
        "èƒ½ä¸æ€»ç»ç†({gm_sign})è¿™æ ·ä½“è´´çš„é¢†å¯¼å…±äº‹ï¼Œæ„Ÿè§‰çœŸå¥½ï¼ä»Šå¤©({date})ä¹Ÿè¦åŠªåŠ›è´¡çŒ®è‡ªå·±çš„åŠ›é‡ï¼"
    ],
    "å¯é çš„ä¼™ä¼´~": [
        "ç›®æ ‡ä¸€è‡´ï¼Œæ­¥è°ƒç»Ÿä¸€ï¼å’Œæ€»ç»ç†è¿™ä¹ˆåˆæ‹ï¼Œä»Šå¤©({date})çš„å·¥ä½œæ•ˆç‡ä¸€å®šè¶…çº§é«˜ï¼",
        "æ„Ÿè§‰è·Ÿç€æ€»ç»ç†ï¼Œæµ‘èº«å……æ»¡äº†åŠ›é‡ï¼ä»Šå¤©({date})ä¹Ÿè¦åŠªåŠ›è·Ÿä¸Šæ€»ç»ç†({gm_sign})çš„æ­¥ä¼ï¼Œä¸€èµ·åŠ æ²¹ï¼",
        "è¸å®çš„ç»„åˆæœ€è®©äººå®‰å¿ƒï¼å’Œæ€»ç»ç†ä¸€èµ·ï¼Œä»Šå¤©({date})ä¸€å®šèƒ½å¤Ÿç¨³æ‰ç¨³æ‰“ï¼Œæ”¶è·æ»¡æ»¡ï¼"
    ],
     "ç»†è‡´çš„å’Œè°~": [
        "ç»†å¿ƒåŠ æŒï¼Œäº‹åŠåŠŸå€ï¼å’Œæ€»ç»ç†ä¸€èµ·å·¥ä½œï¼Œæ€»èƒ½æŠŠç»†èŠ‚åšåˆ°æè‡´ï¼Œä»Šå¤©({date})ä¹Ÿè¦ç»§ç»­ä¿æŒï¼",
        "èƒ½ä¸ºæ€»ç»ç†({gm_sign})åˆ†å¿§è§£éš¾ï¼Œæ˜¯æˆ‘çš„è£å¹¸ï¼ä»Šå¤©({date})è¦æ›´åŠ ç»†å¿ƒï¼Œåšå¥½æ¯ä¸€ä»¶äº‹ï¼",
        "è¿½æ±‚å®Œç¾çš„è·¯ä¸Šæœ‰æ‚¨çœŸå¥½ï¼å’Œæ€»ç»ç†ä¸€èµ·ï¼Œä»Šå¤©({date})ä¸€å®šèƒ½æŠŠå·¥ä½œå®Œæˆå¾—æ¼‚æ¼‚äº®äº®ï¼"
    ],
    "éœ€è¦ç£¨åˆçš„ç¼˜åˆ†~": [
        "è™½ç„¶æ€è€ƒæ–¹å¼ç•¥æœ‰ä¸åŒï¼Œä½†æˆ‘ä»¬ç›®æ ‡ç›¸åŒå‘€ï¼ä»Šå¤©({date})è¦æ›´å¤šåœ°å‘æ€»ç»ç†({gm_sign})è¯·æ•™ï¼Œå…±åŒè¿›æ­¥ï¼",
        "æ²Ÿé€šæ˜¯æ¡¥æ¢~ ä»Šå¤©({date})è¦æ›´ç§¯æåœ°å’Œæ€»ç»ç†äº¤æµæƒ³æ³•ï¼Œç›¸ä¿¡ä¸€å®šèƒ½æ‰¾åˆ°æœ€ä½³æ–¹æ¡ˆï¼",
        "äº’ç›¸å­¦ä¹ ï¼Œå…±åŒæˆé•¿ï¼ä»Šå¤©({date})è¦åŠªåŠ›å‘æŒ¥è‡ªå·±çš„é•¿å¤„ï¼Œå…¨åŠ›æ”¯æŒæ€»ç»ç†çš„å·¥ä½œï¼"
    ],
    "æœ‰è¶£çš„æŒ‘æˆ˜~": [
        "ä¿æŒè°¦é€Šï¼Œä¸æ–­å­¦ä¹ ï¼æ€»ç»ç†({gm_sign})èº«ä¸Šæœ‰å¤ªå¤šå€¼å¾—å­¦ä¹ çš„åœ°æ–¹ï¼Œä»Šå¤©({date})ä¹Ÿè¦è®¤çœŸè§‚å¯Ÿï¼ŒåŠªåŠ›æå‡ï¼",
        "å·®å¼‚ä¹Ÿèƒ½å¸¦æ¥å¯å‘ï¼ä»Šå¤©({date})è¦è™šå¿ƒé¢†ä¼šæ€»ç»ç†çš„æŒ‡å¯¼ï¼Œè®©è‡ªå·±å˜å¾—æ›´ä¼˜ç§€ï¼",
        "åŠªåŠ›å°†æ˜¯æœ€å¥½çš„è¯æ˜ï¼ä»Šå¤©({date})è¦æ›´åŠ ä¸“æ³¨å’ŒæŠ•å…¥ï¼Œç”¨å‡ºè‰²çš„å·¥ä½œæˆæœæ¥å›åº”æ€»ç»ç†çš„æœŸå¾…ï¼"
    ],
    "éœ€è¦äº’ç›¸æ¬£èµ~": [
        "ä¿æŒæ•¬ä½©ï¼ŒåŠªåŠ›è¿½èµ¶ï¼æ€»ç»ç†({gm_sign})çš„æ°”åœºçœŸæ˜¯è®©äººæ•¬ä½©ï¼Œä»Šå¤©({date})è¦æ›´åŠ åŠªåŠ›ï¼Œå‘æ¦œæ ·çœ‹é½ï¼",
        "å›¢é˜Ÿåä½œæœ€é‡è¦ï¼ä»Šå¤©({date})ä¸€å®šç´§å¯†é…åˆæ€»ç»ç†çš„å®‰æ’ï¼Œè´¡çŒ®è‡ªå·±çš„ä¸€ä»½åŠ›ï¼",
        "æ¢ä½æ€è€ƒï¼Œå¢è¿›ç†è§£ï¼ä»Šå¤©({date})è¦å¤šå°è¯•ç†è§£æ€»ç»ç†çš„å†³ç­–æ€è·¯ï¼Œæ›´å¥½åœ°å®Œæˆå·¥ä½œï¼"
    ],
    "é€šç”¨": [ # å˜»å˜»ï¼Œä¸çŸ¥é“è¯´ä»€ä¹ˆçš„æ—¶å€™å¯ä»¥ç”¨è¿™äº›~
        "ä»Šå¤©({date})åˆæ˜¯å……æ»¡å¸Œæœ›çš„ä¸€å¤©ï¼è¦å’Œæ€»ç»ç†ä¸€èµ·åŠ æ²¹é¸­ï¼",
        "ä»Šå¤©({date})é˜³å…‰çœŸå¥½ï¼Œå¿ƒæƒ…ç¾ç¾çš„~ åŠªåŠ›å·¥ä½œï¼Œä¸è¾œè´Ÿæ€»ç»ç†({gm_sign})çš„æœŸæœ›å“¦ï¼",
        "æ–°çš„ä¸€å¤©({date})ï¼Œæ–°çš„èµ·ç‚¹ï¼åœ¨æ€»ç»ç†çš„å¸¦é¢†ä¸‹ï¼Œæˆ‘ä»¬ä¸€å®šèƒ½è¶Šæ¥è¶Šæ£’ï¼",
        "æ„Ÿå—æ€»ç»ç†({gm_sign})çš„æ¦œæ ·åŠ›é‡ï¼Œä»Šå¤©({date})ä¹Ÿè¦åŠªåŠ›å‘å…‰å‘çƒ­ï¼"
    ]
}

def get_zodiac_sign(month, day):
    """æ ¹æ®æœˆä»½å’Œæ—¥æœŸï¼Œæ¸©æŸ”åœ°æ‰¾å‡ºæ‚¨çš„æ˜Ÿåº§~"""
    for sign, ((start_m, start_d), (end_m, end_d)) in ZODIAC_SIGNS.items():
        if (month == start_m and day >= start_d) or (month == end_m and day <= end_d):
            return sign
        # è·¨å¹´çš„æ‘©ç¾¯åº§å®å®è¦ç‰¹æ®Šç…§é¡¾ä¸€ä¸‹~
        if sign == "æ‘©ç¾¯åº§" and (month == 12 or month == 1):
             if month == 12 and day >= 22: return sign
             if month == 1 and day <= 19: return sign
    return None # å¦‚æœæ—¥æœŸä¸å¤ªå¯¹ï¼Œå°±å…ˆç©ºç€å“¦~

def run_astro_matcher_app():
    """è¿è¡Œæ¸©æŸ”çš„æ˜Ÿåº§åŒ¹é…å™¨ç•Œé¢~"""
    st.title(f"é‡‘é™µå·¥å…·ç®± - æ˜Ÿåº§æƒ…ç¼˜å°åŠ©æ‰‹") # æ”¹ä¸ªæ›´å¯çˆ±çš„åå­—~
    st.caption(f"å·å·çœ‹çœ‹æ‚¨å’Œæ€»ç»ç† ({GM_SIGN}) çš„æ˜Ÿåº§å°ç§˜å¯†~ å†é€æ‚¨å‡ å¥æš–å¿ƒå¯„è¯­å“¦...")

    input_type = st.radio("è¯·é€‰æ‹©æ‚¨çš„è¾“å…¥æ–¹å¼å“¦:", ("ç›´æ¥é€‰æ˜Ÿåº§", "è¾“å…¥ç”Ÿæ—¥(æœˆ/æ—¥)"), key="astro_input_type")

    user_sign = None
    if input_type == "ç›´æ¥é€‰æ˜Ÿåº§":
        sign_list = list(ZODIAC_SIGNS.keys())
        # åŠ ä¸€ä¸ªå¯çˆ±çš„æç¤º~
        user_sign = st.selectbox("è¯·é€‰æ‹©æ‚¨çš„æ˜Ÿåº§å§~:", ["è¯·é€‰æ‹©..."] + sign_list, key="astro_sign_select")
        if user_sign == "è¯·é€‰æ‹©...":
            user_sign = None
    else:
        col1, col2 = st.columns(2)
        with col1:
            # é»˜è®¤å€¼è®¾ä¸º0ï¼Œæç¤ºç”¨æˆ·è¾“å…¥
            month = st.number_input("æ‚¨çš„å‡ºç”Ÿæœˆä»½æ˜¯å‡ æœˆå‘€?", min_value=0, max_value=12, value=0, step=1, key="astro_month_input", format="%d")
        with col2:
            day = st.number_input("æ‚¨çš„å‡ºç”Ÿæ—¥æœŸæ˜¯å‡ å·å‘¢?", min_value=0, max_value=31, value=0, step=1, key="astro_day_input", format="%d")

        # åªæœ‰åœ¨è¾“å…¥æœ‰æ•ˆæœˆä»½å’Œæ—¥æœŸæ—¶æ‰è®¡ç®—
        if month > 0 and day > 0:
            try:
                # éšä¾¿æ‰¾ä¸ªå¹´ä»½ï¼ˆæ¯”å¦‚2000å¹´ï¼Œé—°å¹´ï¼‰æ¥éªŒè¯æ—¥æœŸæ˜¯å¦å­˜åœ¨
                 datetime.date(2000, month, day)
                 user_sign = get_zodiac_sign(month, day)
                 if user_sign:
                     st.info(f"å“‡~ æ ¹æ®æ‚¨çš„ç”Ÿæ—¥ï¼Œæ‚¨æ˜¯å¯çˆ±çš„ **{user_sign}** å‘¢ï¼")
                 else:
                     # è¿™ä¸ªæƒ…å†µç†è®ºä¸Šå¾ˆå°‘è§ï¼Œé™¤éæ—¥æœŸæ­£å¥½åœ¨è¾¹ç•Œå¤–
                     st.warning("å“å‘€ï¼Œå¥½åƒæ—¥æœŸæœ‰ç‚¹ç‰¹åˆ«ï¼Œæ²¡æ‰¾åˆ°å¯¹åº”çš„æ˜Ÿåº§å‘¢ï¼Œè¯·å†æ£€æŸ¥ä¸€ä¸‹å“¦~")
            except ValueError:
                st.error("å‘œå‘œï¼Œè¾“å…¥çš„æ—¥æœŸå¥½åƒä¸å¤ªå¯¹å‘¢ï¼Œæœˆä»½å’Œæ—¥æœŸçš„ç»„åˆæœ‰é—®é¢˜å“¦~")
                user_sign = None # æ—¥æœŸæ— æ•ˆå°±æ¸…ç©ºæ˜Ÿåº§

    # åªæœ‰åœ¨è·å–åˆ°æ˜Ÿåº§åæ‰æ˜¾ç¤ºæŒ‰é’®
    if user_sign:
        if st.button("çœ‹çœ‹æˆ‘ä»¬çš„ç¼˜åˆ† & ä»Šæ—¥ä»½é¼“åŠ±~", type="primary"):
            st.markdown("---")
            st.subheader(f"æ‚¨ ({user_sign}) ä¸ æ€»ç»ç† ({GM_SIGN}) çš„æ˜Ÿåº§æƒ…ç¼˜~")

            compatibility = COMPATIBILITY_WITH_SCORPIO.get(user_sign)
            if compatibility:
                level = compatibility["level"]
                desc = compatibility["desc"]

                # æ ¹æ®åŒ¹é…åº¦ç”¨ä¸åŒçš„é¢œè‰²å’Œå›¾æ ‡~
                if "å¥‘åˆ" in level or "ç»„åˆ" in level or "ä¾é " in level:
                    st.success(f"**ç¼˜åˆ†æŒ‡æ•°: {level}** âœ¨")
                elif "ä¼™ä¼´" in level or "å’Œè°" in level:
                    st.info(f"**ç¼˜åˆ†æŒ‡æ•°: {level}** ğŸ˜Š")
                elif "ç£¨åˆ" in level:
                    st.warning(f"**ç¼˜åˆ†æŒ‡æ•°: {level}** ğŸ¤”")
                else: # æŒ‘æˆ˜ or æ¬£èµ
                    st.error(f"**ç¼˜åˆ†æŒ‡æ•°: {level}** ğŸ’–") # ç”¨çˆ±å¿ƒè¡¨ç¤ºéœ€è¦æ›´å¤šç†è§£~

                st.write(desc)

                # --- å¼€å§‹ç”Ÿæˆæ¸©æŸ”çš„å¯„è¯­ ---
                today_str = datetime.date.today().strftime("%Yå¹´%mæœˆ%dæ—¥") # è·å–å½“å¤©æ—¥æœŸ
                possible_phrases = FLATTERY_PHRASES.get(level, []) + FLATTERY_PHRASES["é€šç”¨"] # è·å–å¯¹åº”çº§åˆ«å’Œé€šç”¨çš„
                if possible_phrases:
                    # éšæœºé€‰1-2å¥~
                    num_phrases = random.randint(1, 2)
                    selected_phrases = random.sample(possible_phrases, min(num_phrases, len(possible_phrases)))

                    st.markdown("---")
                    st.subheader("ç»™æ‚¨ä»Šå¤©çš„æ¸©æŸ”é¼“åŠ±:")
                    for phrase in selected_phrases:
                        # æ›¿æ¢é‡Œé¢çš„å ä½ç¬¦~
                        formatted_phrase = phrase.format(date=today_str, gm_sign=GM_SIGN)
                        st.markdown(f"- {formatted_phrase}")
                else:
                     st.write("ï¼ˆå“å‘€ï¼Œä»Šå¤©å¥½åƒæ²¡æœ‰ç‰¹åˆ«çš„å¯„è¯­å‘¢...ï¼‰")

            else:
                st.error("å‘œå‘œï¼Œå¥½åƒå‡ºäº†ä¸€ç‚¹å°é—®é¢˜ï¼Œæ‰¾ä¸åˆ°æ‚¨çš„æ˜Ÿåº§åŒ¹é…ä¿¡æ¯å‘¢ã€‚")
    # å¦‚æœæ²¡é€‰æ˜Ÿåº§æˆ–æ—¥æœŸæ— æ•ˆï¼Œç»™ä¸ªæç¤º
    elif input_type == "ç›´æ¥é€‰æ˜Ÿåº§" and not user_sign:
        st.info("è¯·å…ˆåœ¨ä¸Šé¢é€‰æ‹©æ‚¨çš„æ˜Ÿåº§å“¦~")
    elif input_type != "ç›´æ¥é€‰æ˜Ÿåº§" and not user_sign:
        st.info("è¯·è¾“å…¥æ‚¨çš„ç”Ÿæ—¥æœˆä»½å’Œæ—¥æœŸï¼Œæ‰èƒ½çœ‹åˆ°åŒ¹é…ç»“æœå“¦~")

